---
import Layout from '../../layouts/Layout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import { Button } from '../../components/ui/button';
import { allProducts, collections } from '../../data/products.ts';
import { InteractiveProductGrid } from '../../components/InteractiveProductGrid.tsx';

export function getStaticPaths() {
  return collections.map((collection) => ({
    params: { collectionId: collection.id },
  }));
}

const { collectionId } = Astro.params;

const currentCollection = collections.find(c => c.id === collectionId);
const productsInCollection = allProducts.filter(p => p.collectionId === collectionId);

if (!currentCollection) {
  return Astro.redirect('/404');
}

const breadcrumbLinks = [
  { text: 'Home', href: '/' },
  { text: 'Collections', href: '/collections' },
  { text: currentCollection.title, href: null } // Current page
];
---
<Layout>
  <main>
    <div class="px-6 pt-8">
      <Breadcrumb links={breadcrumbLinks} />
    </div>
    <InteractiveProductGrid 
      client:load 
      products={productsInCollection} 
      title={currentCollection.title} 
      productCount={productsInCollection.length} 
    />
    <div class="text-center my-12">
      <a href="/products">
        <Button variant="outline" size="lg">View All Products</Button>
      </a>
    </div>
  </main>
</Layout>