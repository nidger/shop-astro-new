---
import Layout from '../../layouts/Layout.astro';
import { ProductPurchase } from '../../components/ProductPurchase.tsx';
import Breadcrumb from '../../components/Breadcrumb.astro';
import ProductSection from '../../components/ProductSection.astro';
import { allProducts, collections } from '../../data/products.ts';
import ProductCarousel from '../../components/ProductCarousel.astro';

export function getStaticPaths() {
  return allProducts.map((product) => ({
    params: { slug: product.slug },
  }));
}

const { slug } = Astro.params;
const product = allProducts.find(p => p.slug === slug);

if (!product) {
  return Astro.redirect('/404');
}

const productCollection = collections.find(c => c.id === product.collectionId);

const breadcrumbLinks = [
  { text: 'Home', href: '/' },
  { text: 'Collections', href: '/collections' },
  { text: productCollection?.title, href: `/collection/${productCollection?.id}` }
];

const recommendedProducts = allProducts
  .filter(p => p.collectionId === product.collectionId && p.id !== product.id)
  .slice(0, 4);
---
<Layout>
  <main class="max-w-6xl mx-auto px-6 pt-12 pb-16 bg-background">
    <div class="mb-4 md:hidden">
      <Breadcrumb links={breadcrumbLinks} />
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-8 lg:gap-x-16">
      <div class="xl:col-span-3">
        <ProductCarousel images={product.images} id={product.id} />
      </div>
      
      <div class="py-4 xl:col-span-2">
        <div class="mb-4 hidden md:block">
          <Breadcrumb links={breadcrumbLinks} />
        </div>
        <h1 class="text-3xl md:text-4xl font-bold">{product.title}</h1>
        <p class="text-2xl md:text-3xl text-price my-4">{product.price}</p>
        
        

        <ProductPurchase client:load product={product} />
      </div>
    </div>
  </main>

  {recommendedProducts.length > 0 && (
    <div class="pt-4 pb-16 bg-section-bg">
      <ProductSection 
        title="You might also like"
        products={recommendedProducts}
      />
    </div>
  )}
</Layout>